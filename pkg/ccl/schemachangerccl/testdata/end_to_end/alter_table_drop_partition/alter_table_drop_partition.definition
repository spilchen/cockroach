# NOTE: CockroachDB does not currently enforce range partitions on INSERT/UPDATE.
# This means inserts with values outside any defined partition range will succeed.
# In true range partitioning (e.g., PostgreSQL), such inserts would be rejected.
# This test verifies DROP PARTITION behavior but the insert results may be
# surprising due to this limitation.
setup
CREATE TABLE t_range (
  a INT,
  b INT,
  PRIMARY KEY (a, b)
) PARTITION BY RANGE (a) (
  PARTITION p1 VALUES FROM (1) TO (10),
  PARTITION p2 VALUES FROM (10) TO (20),
  PARTITION p3 VALUES FROM (20) TO (30)
);
INSERT INTO t_range VALUES (5, 1), (15, 1), (25, 1);
----

# DML operations during PostCommitPhase:
# Insert into non-dropped partitions (p2, p3) and dropped partition range (p1).
# All inserts succeed because CRDB doesn't enforce range boundaries on INSERT.
# In PostgreSQL with true range partitioning, inserts into p1's range would fail.
stage-exec phase=PostCommitPhase stage=:
INSERT INTO t_range VALUES (17, 3);
INSERT INTO t_range VALUES (27, 3);
INSERT INTO t_range VALUES (7, 3);
----

# Verify inserts succeeded during PostCommitPhase
stage-query phase=PostCommitPhase stage=:
SELECT count(*) FROM t_range WHERE b = 3;
----
3

test
ALTER TABLE t_range DROP PARTITION p1 WITH DATA;
----
